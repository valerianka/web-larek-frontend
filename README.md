# Проектная работа "Веб-ларек"

Веб приложение онлайн-магазина построенное согласно архитектуре MVP (event-driven). За слой данных (Model) отвечает класс AppData, который работает с данными, проводит вычисления и руководит всеми бизнес-процессами. За слой отображения (View) отвечает класс Component и его производные, показывают пользователю интерфейс и данные из модели на экране.Функцию слоя представителя (Presentation) осуществляет класс Application и обеспечивает связь, является посредником между моделью и видом.

Стек: HTML, SCSS, TS, Webpack (сборка)

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код\

**1. Класс EventEmitter**\
Класс брокера событий. Содержит поля:
- _events: Map<EventName, Set<Subscriber>> - словарь всех событий с множествами их подписчиков
- on<T extends object>(eventName: EventName, callback: (event: T) => void): void - функция, связывающая события с именем заданным в аргументе eventName с функцией-обработчиком, заданной вторым аргументом
- off(eventName: EventName, callback: Subscriber): void - функция, удаляющая функцию-обработчик из списка подписчиков на событие eventName
- emit<T extends object>(eventName: string, data?: T): void - функция инициирующая событие с именем eventName и (опционально) данными data
- onAll(callback: (event: EmitterEvent) => void): void - функция устанавливающая подписчика на все события
- offAll(): void - функция сбрасывающая всех подписчиков
- trigger<T extends object>(eventName: string, context?: Partial<T>): void - функция создающая колбэк-тригер, генерирующий событие eventName
Отвечает за передачу и принятие сигналов, таким образом осуществляя коммуникацию между компонентами данных и представления. 

**2. Класс  API**\
Базовый класс API запросов. Содержит поля:
- protected handleResponse(response: Response): Promise<object> - функция обработки ответа от сервера
- get(uri: string): void - функция создающая запрос GET к серверу по заданному url
- post(uri: string, data: object, method: ApiPostMethods = 'POST') - функция создающая запрос POST к серверу по заданному url с данными data\
Конструктор принимает адрес API сервера и общий список заголовков для всех запросов. Класс отвечает за формирование запросов GET и POST к серверу и обработку ответа от сервера.

**3. Класс Component<T>**\
Класс отвечает за работу с компонентом-элементом разметки и создание представления компонента с данными T. Содержит поля:
- protected container: HTMLElement - элемент контейнера-родителя
- protected _content: HTMLElement - элемент компонента
- protected _events: EventEmitter - объект брокера событий
- toggleClass(element: HTMLElement, className: string, force?: boolean): void - функция меняющая наличие/отсутствия класса у переданного html элемента
- protected setText(element: HTMLElement, value: unknown): void - функция устанавливающая текстовое значение в html элемент
- setDisabled(element: HTMLElement, state: boolean): void - функция устанавливающая активное/неактивное состояние переданному элементу
- protected setHidden(element: HTMLElement): void - функция скрывающая переданный элемент
- protected setVisible(element: HTMLElement): void - функция изменяющая видимость переданного элемента на видимую
- protected setImage(element: HTMLImageElement, src: string, alt?: string): void - функция установки изображение с заданным источником в переданный элемент
- render(): HTMLElement | void - функция создающая html представление компонента
- setData(data: Partial<T>): void - функция изменения содержимого данных компонента
- removeComponent(): void - функция удаляющая компонент из разметки
Конструктор принимает html элемент-контейнер родителя компонента container, селектор по которому необходимо создать соответствующий компонент представления с типом модели данных T и объект брокера событий events. Типы компонентов: IProduct, IBasket, IOrder, ICatalogItems<IProduct>, IModalData, IFormState.


##Компоненты слоя данных (Model)\

**1. Класс AppData**\
Основной класс слоя данных отвечающий за взаимодействие с классами слоя данных приложения. Содержит следующие поля:
- catalog: CatalogItems[] - массив экземпляров объектов товаров каталога
- basket: string[] - массив id товаров находящихся в корзине
- order: Order - экземпляр объекта заказа
- preview: string | null - id товара в текущем модальном окне просмотра товара (если оно открыто)
- orderFormErrors: IFormState - объект данных состояния формы заказа
- contactsFormErrors: IFormState - объект данных состояния формы контактов
- events: EventsEmitter - экземпляр объекта брокера событий
- addToBasket(string): void - функция добавляющая id товара в корзину и сигнализирующая событие "basket:changed"
- setCatalogItems(items: IProduct[]): void - функция задающая данные товаров каталога
- setPreview(string): void - функция устанавливающая значение id товара в текущем открытом окне просмотра товара
- removeFromBasket(string): void - функция удаляющая данные товара с переданным id из модели корзины и сигнализирующая событие "basket:changed"
- getTotal(): number - функция вычисляющая и возвращающая общую сумму товаров в корзине
- validateOrder(): boolean - функция валидации формы заказа, устанавливающая сообщения ошибок полям формы заказа
- validateContacts(): boolean - функция валидации формы контактов, устанавливающая сообщения ошибок полям формы контактов
- setOrderData(Partial<IOrder>): void - функция заполняющая данные заказа
Конструктор принимает объект брокера событий. Класс ответственнен за хранение и изменение объектов каталога товаров, корзины, заказа(ов), id товара в модальном окне превью, данных состояния форм. Отвечает за работу с данными приложения, а также коммуникацию с слоем представления через брокер событий.

**2. Класс CatalogItems**\
Модель данных каталога товаров, имплементирует интерфейс ICatalogItems<IProduct>. Содержит поля:
- items: IProduct[] - массив товаров типа IProduct
- getProductById(string): IProduct - функция для получения объекта товара из списка товаров с переданным id
- addProduct(IProduct): void - функция для добавления переданного объекта товара в список товаров
Конструктор принимает (опционально) массив товаров типа IProduct. Для работы со списком товаров используются функции getProductById, addProduct, removeProduct, которые получают товар из списка или его id устанавливают новый список товаров, добавляют товар в список и удаляют товар с заданным id из списка. Для работы с полем items испульзуются стандартные get и set методы. 

**3. Класс Order**\
Модель данных заказа. Содержит поля:
- payment: string - тип оплаты
- email: string - адрес электронной почты заказчика
- phone: string - номер телефона заказчика
- address: string - адрес доставки заказчика
- protected _total: number - общая сумма заказа, задается сеттером на основе общей суммы товаров корзины
- protected _items: string[] - массив id товаров в заказе, задается сеттером на основе данных корзины
Класс имплементирует интерфейс IOrder. Класс отвечает за хранение данных заказа для отправки на сервер.

**4. Класс Basket**\
Модель данных корзины товаров. Класс имплементирует интерфейс IBasket. Содержит поля:
- protected _orderItems: IProduct[]; - массив товаров в корзине
- addProduct(IProduct): void; - добавляет объект товара в массив товаров в корзине
- removeProduct(string): void; - удаляет объект товара с переданным id из массива товаров в корзине
- calculateTotal(): number; - вычисляет общую стоимость товаров в корзине
- get orderItems(): IProduct[]; - геттер данных массива товаров в корзине
Отвечает за хранение данных корзины и реагирует на изменении данных корзины (добавлении или удалении) через взаимодействие с брокером событий. Содержит массив данных всех товаров находящихся в корзине, функции для работы с массивом данных и вычисления общей стоимости товаров в корзине. 

##Компоненты слоя представления (View)\

**1. Класс Modal**\
Класс модального окна. Расширяет класс Component типа IModalData. Содержит поля:
- protected _closeButton: HTMLButtonElement - кнопка закрытия модального окна
- open(): void - функция открытия модального окна
- close(): void - функция закрытия модального окна
- render(): HTMLElement - функция, возвращающая представления элемента модального окна
Отвечает за создание представления модального окна по шаблону с классом переданным в конструктор, навешивания обработчиков событий на интерактивные элементы, функциональность открытия-закрытия модального окна и отрисовку с переданным содержимым. Конструктор принимает html элемент родителя, селектор элемента шаблона, который необходимо клонировать и создать данный вид модального окна с заданными данными, а так же объект брокера событий для навешивания обработчиков событий.

**2. Класс Form**\
Класс представления формы. Расширяет класс Component типа IFormState. Содержит поля:
- protected _submitButton: HTMLButtonElement - кнопка отправки формы
- protected _name: string - название формы
- protected _inputs: NodeListOf<HTMLInputElement> - список элементов ввода формы
- protected _errors: Record<string, HTMLElement>[] - список элементов с ошибками по именам полей
- protected _form: HTMLFormElement - html элемент формы
- get form: HTMLElement - возвращает элемент формы
- getInputValues(): Record<string, string> - функция возвращающая значения полей введенных пользователем по именам полей
- setInputValues(Record<string, string>): void - функция задающая переданные значения полям формы по именам полей
- setValid(value: boolean) - функция установки состояния формы и ее элементов
- setError(data: {field: string, value: string, message: string}) - функция установки ошибки валидации формы в указанном поле по указанному значению
- showInputError({field: string, errorMessage: string}): void - функция отображающая ошибку данных под полем формы
- hideInputError(fieldr string): void - функция скрывающая текст ошибки по указанному поле
- onInputChange(): void - функция обработчик события изменения инпута
- setData(formState: Partial<IFormState>): void - функция установки данных формы
- render(): HTMLElement - функция создания представления формы
Отвечает за создание представления формы, навешивания обработчиков событий на интерактивные элементы, установление состояния в зависимости от валидности формы. Конструктор принимает html элемент родителя container, селектор шаблона, который необходимо клонировать и создать форму, объект функции-обработчика события нажатия кнопки submitButton, а так же объект брокера событий для навешивания обработчиков событий. 

**3. Класс HomePageView**\
Класс представления главной страницы сайта. Расширяет класс Component типа ICatalogItems<IProduct>. Содержит поля:
-	protected _catalog: HTMLElement[] -  массив элементов карточек товаров каталога
-	protected _basket: HTMLButtonElement - элемент корзины
-	render(): HTMLElement - функция создания представления главной страницы приложения
- setData(data: Partial<ICatalogItems<IProduct>>): void - функция изменения содержимого каталога главной страницы
Конструктор принимает элемент контейнера родителя container, объект брокера событий events. Отвечает за создание представления главной страницы сайта со списком товаров и корзиной, отображение переданных данных товаров и навешиванием обработчиков событий на интерактивные элементы.

**4. Класс BasketView**\
Класс представления модального окна корзины. Расширяет класс Component типа IBasket. Содержит поля:
-	protected _list: HTMLElement[] - массив элементов товаров в корзине
-	protected _total: number - общая сумма заказа
-	protected orderButton: HTMLButtonElement - кнопка "Оформить" оформления заказа
- render(): HTMLElement - функция создания представления корзины
- setData(data: Partial<IBasket>): void - функция изменения содержимого корзины
Отвечает за создание представления корзины заказа, работы с изменением содержания корзины, навешивания обработчиков событий. Конструктор принимает элемент родителя, селектор шаблона элемента, объект брокера событий.

**5. Класс CardView**\
Класс отвечает за создание элемента html карточки продукта, расширяет класс Component типа IProduct. Содержит поля:
-	protected image?: HTMLImageElement - элемент картинки товара (необязательный)
-	protected name?: HTMLElement - элемент названия товара
-	protected price?: HTMLElement - элемент цены товара
-	protected description?: HTMLElement;
-	protected _addButton?: HTMLButtonElement - элемент кнопки "В корзину" добавления товара в заказ (необязательный)
-	protected _deleteButton?: HTMLButtonElement - элемент кнопки удаления товара из заказа (необязательный)
- render(): HTMLElement - функция возвращающая представление карточки заказа
- setData(data: Partial<IProduct>): void - функция изменения содержимого карточки
Отвечает за создание представления элемента карточки товара, работы с содержимым карточки, присваивает слушатели событий на все интерактивные элементы. Конструктор принимает html элемент родителя container, селектор шаблона по которому необходимо сделать html элемент карточки для создания элемента представления карточки нужного вида, и объект брокера событий, который будет использоваться в колбэках при присвоении обработчиков событий интерактивным эелементам.

**6. Класс OrderView**\
Класс отображения формы оформления заказа наследующий класс Form.  Содержит поля:
-	protected _payment: PaymentType - тип оплаты
-	protected _address: HTMLElement - элемент поля адреса
- getInputValues(): Record<string, string> - функция возвращающая значения полей введенных пользователем по именам полей
- setInputValues(Record<string, string>): void - функция задающая переданные значения полям формы по именам полей
- render(): HTMLElement - функция возвращающая представление карточки заказа
- onSubmit(order: Partial<IOrder>): void - функция-обработчик события нажатия кнопки "Далее"
- setData(data: Partial<IFormState>): void - функция изменения содержимого 
Отвечает за создание представления элемента формы заказа, работу с установкой значений полей и ошибок, и навешивания обработчиков событий на интерактивные элементы представления окна формы оформления заказа. Конструктор принимает html элемент родителя container, селектор шаблона по которому необходимо сделать html элемент карточки для создания элемента представления карточки нужного вида, и объект брокера событий, который будет использоваться в колбэках при присвоении обработчиков событий интерактивным эелементам.

**7. Класс ContactsView**\
Класс отображения формы контактной информации покупателя наследующий класс Form. Содержит поля:
-	protected _phone: string;
-	protected _email: string;
- onSubmit(order: Partial<IOrder>): void - функция обработчик события нажатия кнопки "Оплатить". Сигнализирует событие создания заказа модели данных Order. По нажатию кнопки "Оплатить" генерируется событие `order:create`, которое оповещает модель данных Order о том, что необходимо создать новый заказ. Конструктор принимает html элемент родителя container, селектор шаблона по которому необходимо сделать html элемент карточки для создания элемента представления карточки нужного вида, и объект брокера событий, который будет использоваться в колбэках при присвоении обработчиков событий интерактивным эелементам.

**8. Класс SuccessView**\
Класс отображения сообщения об успешном создании заказа наследующий класс Component типа ISuccess. Содержит поля:
- onButtonClick(): void - функция обработчик события нажатия на кнопку "За новыми покупками!"
Отвечает за создание и навешивания обработчиков событий на интерактивные элементы представления сообщения о создании заказа. Конструктор принимает html элемент родителя container, селектор шаблона по которому необходимо сделать html элемент карточки для создания элемента представления карточки нужного вида, и объект брокера событий, который будет использоваться в колбэках при присвоении обработчиков событий интерактивным эелементам. 

##Компоненты слоя коммуникаций\

**1. Класс ProductsAPI**\
Класс расширяет родительский класс API. Содержит поля:
- getProduct(path: string): Promise<IProduct> - функция создания запроса товара
- getCatalogItems(path: string): Promise<IProduct[]> - функция создания запроса списка всех товаров
- createOrder(order: IOrder): boolean - функция создания запроса на создание заказа с переданными данными
Отвечает за отправку API запросов на получение данных товара, списка всех товаров и создание заказа с переданными данными.

##Взаимодействие компонентов
Код, выполняющий функцию инициализатора(создание всех экземпляров классов и настройка обработки событий) и слой Presenter находится в файле `index.ts`. Взаимодействие осуществляется с помощью событий генерируемых брокером событий и обработчиков этих событий, описанных в `index.ts`.

**Названия событий EventName:**\
**События изменения данных**\
- `products:changed` - событие изменения массива товаров при получении ответа от сервера ProductApi:getProducts()\
- `order:created` - создается при получении успешного ответа от сервера на запрос ProductApi:setOrder(data)\

**События взаимодействия пользователя с интерфейсом**\
- `ProductView:open` - событие при нажатии на карточку каталога товаров\
- `BasketView:open` - событие при нажатии на кнопку-иконку корзины с главной страницы сайта\
- `BasketView:submit` - событие при нажатии на кнопку "Оформить" из  модального окна корзины\
- `OrderView:open` - cобытие вызываемое при обработке события `BasketView:submit` брокером для открытия модального окна OrderView\
- `OrderView:submit` - событие вызываемое при нажатии на кнопку "Далее" модального окна оформления заказа\
- `ContactsView:open` - событие открытия окна контактов покупателя\
- `ContactsView:submit` - событие вызываемое при нажатии на кнопку "Оплатить" из модального окна контактов покупателя\
- `SuccessView:open` - событие при получении успешного ответа от API ProductApi:setOrder\
- `{ViewName}:close` - событие зактырия данного модального окна\ 
- `product:add` - событие при нажатии на кнопку "Купить" модального окна карточки\
- `product:delete` - событие при нажатии на кнопку корзины напротив товара в корзине\
- `edit-order:input` - событие изменения данных в форме оформления заказа\
- `edit-contacts:input` - событие изменения данных в форме контактов покупателя\ 
- `order:submit` - событие при нажатии кнопки "Оплатить" из модального окна контактов\ 
- `edit-order:validation` - событие валидации формы оформления заказа\
- `edit-contacts:validation` - событие валидации формы контактов покупателя\
