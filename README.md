# Проектная работа "Веб-ларек"

Веб приложение онлайн-магазина построенное согласно архитектуре MVP (event-driven).

Стек: HTML, SCSS, TS, Webpack (сборка)

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код\

**Компоненты слоя данных (Model)**\

**1. Интерфейс IProduct**\
Модель данных товара на аукционе. Содержит поля:\
- id: number\
- title: string\
- description: string\
- price: number\
- category: string\
- image: string\

**2. Интерфейс ICatalogItems<T>**\
Дженерик - модель данных каталога товаров класса T. Содержит поля:\
- items: T[] - массив товаров типа T\
- getProductById(string): IProduct\
- addProduct(IProduct): void\
- removeProduct(string): void\
Для работы со списком товаров используются функции getProductById, addProduct, removeProduct, которые получают товар из списка или его id устанавливают новый список товаров, добавляют товар в список и удаляют товар с заданным id из списка. Для работы с переменной items испульзуются стандартные get и set методы.\

**3. Интерфейс IOrder**\
Модель данных заказа. Содержит поля:\
- payment: string - тип оплаты\
- email: string - адрес электронной почты заказчика\
- phone: string - номер телефона заказчика\
- address: string - адрес доставки заказчика\
- total: number - общая сумма заказа\
- items: string[] - массив id товаров в заказе\
- add: function(string): void - функция добавления товара в корзину (заказ) через добавление его id в массив items\
- remove: function(string): void - функция удаления товара из корзины (заказа) через удаление его id из массива items\

**Компоненты слоя представления (View)**\

**1. Класс Component<T>**\
Класс дженерик - отвечает за создание элемента типа T. Конструктор принимает html элемент-контейнер родителя компонента container, селектор по которому необходимо создать соответствующий компонент представления с типом модели данных T и объект брокера событий events. Содержит функции render , setData - обновляет компонент при изменении данных модели - и removeComponent - удаления html элемента компонента. Типы компонентов: IProduct, IBasket, IOrder, IPage, IModalData, IModalWithFormData.\

**1.1. Интерфейс IModalData**\
Интерфейс объекта представления модального окна. Хранит html элемент контента окна в поле content, кнопку закрытия модального окна closeButton, фунцкии открытия и закрытия окна open и close:\
- content: HTLMElement\
- closeButton: HTMLButtonElement\
- open: function()\
- close: function()\

**1.2. Интерфейс IModalWithFormData**\
Интерфейс объекта модального окна с формой. Содержит элемент формы form, кнопку submitButton, кнопку closeButton, массив ошибок errors, функции открытия и закрытия окна open, close, функцию проверки ошибок checkValidation.\

**1.3. Интерфейс IBasket** \
Интерфейс объекта представления корзины. Содержит поля items: IProduct[], total: number.\

**2. Класс Modal<T>**\
Класс дженерик модального окна товара(Modal<CardView>), корзины(Modal<BasketView>) и оповещения об успешном создании заказа(Modal<SuccessView>). Расширяет класс Component типа IModalData. Содержит html элемент родителя модального окна container, кнопку закрытия closeButton, функции открытия и закрытия окна open(), close(). Отвечает за создание представления модального окна, навешивания обработчиков событий на интерактивные элементы. Конструктор принимает html элемент родителя container, селектор шаблона, который необходимо клонировать и создать данный вид модального окна с заданными данными, а так же объект брокера событий для навешивания обработчиков событий. Содержит методы render возвращающий отображение модального окна с заполненными элементами и присвоенными слушателями событий, open, close для открытия и закрытия окна, setData присваивающий элементам модального окна переданные значения.\

**3. Класс ModalWithForm<T>**\
Класс дженерик модального окна формы оформления заказа ModalWithForm<T> (OrderView или ContactsView). Расширяет класс Component типа IModalWithFormData. Содержит html элемент родителя модального окна container, кнопку закрытия closeButton, массив сообщений ошибок errors, функции открытия и закрытия окна open(), close(). Отвечает за создание представления модального окна, навешивания обработчиков событий на интерактивные элементы. Конструктор принимает html элемент родителя container, селектор шаблона, который необходимо клонировать и создать данный вид модального окна с заданными данными, а так же объект брокера событий для навешивания обработчиков событий. Содержит методы render возвращающий отображение модального окна с заполненными элементами и присвоенными слушателями событий, open, close для открытия и закрытия окна, setData присваивающий элементам модального окна переданные значения, checkValidation - обработчик события "input" формы которая проверяет валидность полей и меняет атрибут disabled кнопки, и setError - функция обновляющая сообщение об ошибке для невалидного поля.\ 

**4. Класс HomePage<T>**\
Класс представления главной страницы сайта. Расширяет класс Component типа ICatalogItems<T>. Конструктор принимает элемент контейнера родителя container, объект брокера событий events. Содержит html элемент контейнера контента container, элемент списка товаров catalog, элемент корзины basket, функции render, setData. Отвечает за создание представления главной страницы сайта со списком товаров и корзиной и навешиванием обработчиков событий на интерактивные элементы.\

**5. Класс BasketView**\
Класс представления модального окна корзины. Расширяет класс Component типа IBasket. Содержит элементы контейнера родителя container, объект брокера событий events, кнопки orderButton и closeButton и функции-обработчики onAdd(), onRemove(), render, setData.\

**6. Класс ProductView**\
Класс отвечает за создание элемента html карточки продукта, расширяет класс Component типа IProduct. Содержит элементы deleteButton?, addButton?, closeButton?, и присваивает слушателей событий на все интерактивные элементы. Конструктор принимает html элемент родителя container и селектор шаблона по которому необходимо сделать html элемент карточки selector для создания элемента представления карточки нужного вида, и объект брокера событий, который будет использоваться в колбэках при присвоении обработчиков событий интерактивным эелементам. Содержит методы  render возвращающий отображение карточки с заполненными полями и присвоенными слушателями событий, removeCard удаляющий разметку карточки, setData присваивающий элементам карточки переданные значения.\

**7. Класс OrderView**\
Класс отображения формы оформления заказа наследующий класс Component типа IOrder. Отвечает за создание и навешивания обработчиков событий на интерактивные элементы представления модального окна формы оформления заказа с полями payment, address и кнопкой nextButton, по которой генерируется событие OrderView:submit.\

**8. Класс ContactsView**\
Класс отображения формы контактной информации покупателя наследующий класс Component типа IOrder. Отвечает за создание и навешивания обработчиков событий на интерактивные элементы представления модального окна формы контактов с полями email, phoneNumber и кнопкой createOrderButton, по нажатию которой генерируется событие `order:create`, которое оповещает брокер о том, что необходимо послать API запрос на создание заказа и передает параметры заказа. Содержит функцию-обработчик события `OrderView:submit` onOrderNext.\

**9. Класс SuccessView**\
Класс отображения модального окна сообщения об успешном создании заказа наследующий класс Component типа IModalData. Отвечает за создание и навешивания обработчиков событий на интерактивные элементы представления модального окна сообщения о создании заказа.\ 

**Компоненты слоя коммуникаций**\

**1. Класс  API**\
Базовый класс API запросов. Конструктор принимает адрес API сервера и общий список заголовков для всех запросов. Класс содержит методы get и post для формирования запросов к серверу GET и POST, и метод handleResponse для обработки ответа от сервера.\

**2. Класс ProductsAPI**\
Класс расширяет родительский класс API. Отвечает за формирование запросов и обработку ответов с сервера. Содержит методы getProduct(string):Promise<IProduct>, getCatalogItems():Promise<IProduct[]> createOrder(data):Promise<boolean>.\

**Класс приложения Application**\
Класс синглотон приложения онлайн магазина. Реализует функцию инициализатора и слой Presenter в архитектуре MVP. Отвечает за создание, инициализацию и хранение единственного объекта приложения application, презентацию слоя отображения. Конструктор принимает объект с данными инициализации слоев коммуникаций, создает все необходимые объекты для приложения (брокер событий, api, компоненты отображений), навешивает обработчики событий. Класс содержит метод run() запускающий отображажение созданной главной страницы приложения.\

**Компоненты брокера событий**\

**1. Тип EventName**\
Описывает название события или регулярное выражение.\

**2. Тип Subscriber**\
Описывает подписчика - функцию вызываемую при определенном событии.\

**3. Тип EmitterEvent** 
Описывает объект из 2 полей - названия события eventName и связанных с ним данных data (если есть).\

**4. Интерфейс IEvents**\
Интерфейс описывает функции брокера событий. Содержит методы on, emit и trigger, связывающие события в слое представления (нажатие на кнопку, оверлей и др.) с функциями-обработчиками, оповещающие слой представления об изменениях в слое данных (получении данных с сервера и обновления) и генерирующие событие при вызове.\

**5. Класс EventEmitter**\
Класс синглтон брокера событий, содержит словарь всех событий с множествами их подписчиков _events: Map<EventName, Set<Subscriber>> и функции on, off, emit, onAll, offAll и trigger для добавления и снятия обработчиков событий, отправки событий всем подписчикам и отписки всех подписчиков.\

**Названия событий EventName:**\
**События изменения данных**\
- `products:changed` - событие изменения массива товаров при получении ответа от сервера ProductApi:getProducts()\
- `order:created` - создается при получении успешного ответа от сервера на запрос ProductApi:setOrder(data)\

**События взаимодействия пользователя с интерфейсом**\
- `ProductView:open` - событие при нажатии на карточку каталога товаров\
- `BasketView:open` - событие при нажатии на кнопку-иконку корзины с главной страницы сайта\
- `BasketView:submit` - событие при нажатии на кнопку "Оформить" из  модального окна корзины\
- `OrderView:open` - cобытие вызываемое при обработке события `BasketView:submit` брокером для открытия модального окна OrderView\
- `OrderView:submit` - событие вызываемое при нажатии на кнопку "Далее" модального окна оформления заказа\
- `ContactsView:open` - событие открытия окна контактов покупателя\
- `ContactsView:submit` - событие вызываемое при нажатии на кнопку "Оплатить" из модального окна контактов покупателя\
- `SuccessView:open` - событие при получении успешного ответа от API ProductApi:setOrder\
- `{ViewName}:close` - событие зактырия данного модального окна\ 
- `product:add` - событие при нажатии на кнопку "Купить" модального окна карточки\
- `product:delete` - событие при нажатии на кнопку корзины напротив товара в корзине\
- `edit-order:input` - событие изменения данных в форме оформления заказа\
- `edit-contacts:input` - событие изменения данных в форме контактов покупателя\ 
- `order:submit` - событие при нажатии кнопки "Оплатить" из модального окна контактов\ 
- `edit-order:validation` - событие валидации формы оформления заказа\
- `edit-contacts:validation` - событие валидации формы контактов покупателя\
